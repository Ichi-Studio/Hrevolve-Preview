# Hrevolve 黑盒测试计划（完整）
日期：2026-02-07  
测试类型：黑盒（API 驱动为主，覆盖 UI 端到端抽样）  
质量模型：ISO/IEC 25010（功能适合性、性能效率、兼容性、可用性、可靠性、安全性、可维护性、可移植性）

## 1. 测试目标
- 在不依赖内部实现细节的前提下，对“用户可观察输入/输出/行为”进行验证，覆盖正常、边界、异常与端到端主链路。
- 以“需求条目覆盖率”作为主要覆盖指标，目标 ≥ 90%（见覆盖矩阵）。
- 对关键风险（多租户隔离、RBAC、数据一致性、关键接口性能长尾）进行专项验证并给出上线风险结论。

## 2. 依据与参考
- 需求规格说明书：[RequirementsDocument.md](file:///d:/HomeCode/Hrevolve/Design/RequirementsDocument.md)
- 项目总览：[README.md](file:///d:/HomeCode/Hrevolve/README.md)
- 后端说明/API 说明：[Backend/README.md](file:///d:/HomeCode/Hrevolve/Backend/README.md)
- 既有 E2E 黑盒报告（基线）：[BlackBoxTestReport_2026-02-06.md](file:///d:/HomeCode/Hrevolve/TestReports/BlackBoxTestReport_2026-02-06.md)
- 运行时 OpenAPI：`/openapi/v1.json`（Development 环境）

## 3. 测试范围与优先级
### 3.1 范围口径
- “本轮范围”按两层定义：
  - L1（可交付）：当前仓库可运行版本中已暴露的 API/页面能力（以 OpenAPI 端点清单 + 前端路由为准）。
  - L2（需求缺口）：需求规格说明书中描述但当前版本未实现/仅占位的能力（作为风险与改进建议输出，不计入执行失败，但计入需求差距）。

### 3.2 范围清单（按用户可见模块）
P0（必须通过，阻断上线）：
- 认证与会话：登录/刷新/登出/当前用户
- 多租户：租户识别、跨租户访问隔离
- RBAC：401/403 行为、关键写操作权限边界
- 组织与员工：组织树、员工列表/详情、历史时点查询、任职历史
- 考勤：签到/签退、我的记录、月度统计、异常纠正流程（如有）
- 假期：假期类型、余额、请假申请、审批/驳回/撤销、状态一致性
- 报销：类型、申请、审批、金额边界
- 薪酬：周期、薪资单查询（员工）、HR 查询（如有）

P1（重要，建议通过，上线可接受少量已知缺陷）：
- 排班：可排班员工、班次模板、排班分配、排班统计
- 公司基础资料：标签、成本中心、打卡设备
- 系统设置：用户/角色/权限、审计日志查询与导出
- AI 助手：对话、历史查询/清理（Mock Provider）
- 多语言：locale 列表、消息包

P2（增强，作为质量加分项/风险提示）：
- 保险、个税模块（以接口可达性与返回结构一致性为准）
- 兼容性抽样（Chromium 系浏览器为基线；其他浏览器列为风险）
- 性能基准抽样（本地环境 p50/p95，作为回归基线）

### 3.3 不在本轮强制执行范围（输出风险提示）
- 真实 SSO/MFA/扫码登录全链路（对接外部 IdP/短信/邮件/微信生态）
- RAG 向量库与知识库内容治理（当前为 Mock/占位）
- Webhook/SCIM/企业级网关与限流、生产级审计保留与备份策略
- 万级并发容量压测（本轮仅做单机抽样基线）

## 4. 测试技术与用例设计方法
本轮用例设计在“黑盒可观察行为”层面应用以下技术，并在用例中标注使用方法：
- 等价类划分：登录凭据、分页参数、金额/日期输入等
- 边界值分析：金额上限、日期范围、分页 page/pageSize、字符串长度（若接口校验）
- 决策表：RBAC（角色 × 操作 × 资源）、审批流（状态 × 操作）
- 状态转换：请假/报销/考勤纠正等状态机
- 因果图：输入校验（日期/金额/必填）与输出错误码映射
- 正交实验：对“请假申请”多因子组合抽样（假期类型 × 时长 × 是否附件 × 跨月/跨年）

## 5. 覆盖率口径与退出准则
### 5.1 覆盖率口径（≥90%）
- 需求条目覆盖：覆盖矩阵中每条“可测试需求条目”至少有 1 条用例命中并执行（PASS/FAIL/BLOCK/NA）。
- 计算方式：覆盖率 =（状态为 PASS/FAIL/BLOCK 的需求条目数）/（可测试需求条目总数）× 100%。
- 说明：NA 仅用于“本轮明确不在范围或当前版本未实现”的需求条目，并在总结中列为风险/欠账。

### 5.2 进入/退出准则
进入准则：
- 后端可启动且 OpenAPI 可访问；演示租户数据可用或可重新初始化。

退出准则：
- P0 用例全部 PASS；P1 允许存在少量 S3/S4 缺陷且有规避方案；无 S1 安全缺陷与数据一致性阻断项。
- 输出测试总结报告、缺陷清单与遗留风险评估。

## 6. 测试环境与数据（独立环境）
### 6.1 独立测试环境策略
- 目标：不依赖本机 PostgreSQL/Redis 服务也能完成端到端回归（适用于 CI/沙箱）。
- 实现：通过连接串切换为 SQLite，Redis 使用内存缓存（已在基础设施层支持）。

### 6.2 启动参数（推荐）
- 环境：Development（用于启用 OpenAPI/Scalar）
- 连接：`ConnectionStrings__DefaultConnection=Data Source=hrevolve_test.sqlite`
- Redis：`ConnectionStrings__Redis=disabled`
- 证书：HTTPS 为开发证书，测试工具需跳过证书校验或信任证书（见自动化脚本约定）

### 6.3 演示数据与账号
- 演示租户：`demo`
- 账号（演示租户）：
  - 普通员工：`demo_user / demo123`
  - HR 管理员：`demo_hr / demo123`
  - 系统管理员：`demo_admin / demo123`

## 7. 质量模型（ISO 25010）映射
- 功能适合性：业务主链路与接口契约（OpenAPI/返回结构/错误码）
- 性能效率：关键查询接口抽样 p50/p95、错误率
- 兼容性：API 协议兼容（HTTP/JSON）；UI 仅对 Chromium 抽样
- 可用性：错误提示一致性、关键操作的可理解反馈（黑盒可观察）
- 可靠性：幂等/并发（抽样）、异常处理与稳定性（5xx、超时）
- 安全性：认证/鉴权、最小权限、租户隔离、敏感信息不泄露
- 可维护性：以“可测试性/可观测性”为主（日志、错误码一致性）
- 可移植性：独立测试环境（SQLite/MemoryCache）可运行性

## 8. 交付物清单
- 测试范围与覆盖矩阵：[BlackBoxCoverageMatrix_2026-02-07.md](file:///d:/HomeCode/Hrevolve/TestReports/BlackBoxCoverageMatrix_2026-02-07.md)
- 测试用例集：[BlackBoxTestCases_2026-02-07.md](file:///d:/HomeCode/Hrevolve/TestReports/BlackBoxTestCases_2026-02-07.md)
- 自动化执行脚本与原始结果（JSON/日志）：`tests/blackbox/*`
- 缺陷报告模板与缺陷实例：`TestReports/Defects/*`
- 测试总结报告：[BlackBoxTestReport_2026-02-07.md](file:///d:/HomeCode/Hrevolve/TestReports/BlackBoxTestReport_2026-02-07.md)
